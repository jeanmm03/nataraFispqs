<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DE SANTA - FISPQS NATARA</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    /* Modal */
    #modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    #modalContent {
      position: relative;
      width: 90%;
      max-width: 900px;
      height: 90%;
      background: white;
      border-radius: 12px;
      overflow: hidden;
    }
    #modal iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    #closeBtn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      font-weight: bold;
      cursor: pointer;
      z-index: 10;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-yellow-100 to-white flex items-center justify-center min-h-screen px-4">

  <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md text-center">
    <h2 id="boasVindas" class="text-3xl font-semibold text-gray-800 mb-4">Bem-vindo!</h2>
    <p class="text-gray-600 mb-6">Selecione um arquivo para visualizar:</p>

    <select id="lista" class="w-full border border-gray-300 rounded-lg p-3 mb-6 text-gray-700 focus:ring-yellow-400 focus:outline-none transition duration-150 ease-in-out">
      <option value="">-- Selecione --</option>
    </select>

    <button
      onclick="abrirItemSelecionado()"
      class="w-full bg-yellow-400 text-black font-medium py-3 rounded-lg hover:bg-yellow-500 transition duration-200 ease-in-out"
    >
      Acessar Arquivo
    </button>
  </div>

  <!-- Modal para visualizar PDF -->
  <div id="modal" class="flex">
    <div id="modalContent">
      <button id="closeBtn" onclick="fecharModal()">X</button>
      <iframe id="pdfFrame" src=""></iframe>
    </div>
  </div>

  <script>
    window.onload = async () => {
      const nome = localStorage.getItem('usuarioNome') || 'UsuÃ¡rio';
      document.getElementById('boasVindas').textContent = `ðŸ‘‹ Bem-vindo, ${nome}!`;

      try {
        // Buscar JSON manual
        const res = await fetch('arquivos.json');
        if (!res.ok) throw new Error(`Erro ao buscar JSON: ${res.status}`);
        const data = await res.json();
        const lista = document.getElementById('lista');

        if (!data || data.length === 0) {
          const opt = document.createElement("option");
          opt.textContent = "Nenhum PDF encontrado.";
          opt.disabled = true;
          lista.appendChild(opt);
          return;
        }

        // Ordena os arquivos pelo nome
        data.sort((a, b) => a.nome.localeCompare(b.nome, 'pt-BR', { sensitivity: 'base' }));

        // Preenche a lista
        data.forEach(file => {
          const opt = document.createElement('option');
          opt.value = file.caminho;
          opt.textContent = `ðŸ“„ ${file.nome}`;
          lista.appendChild(opt);
        });

      } catch (error) {
        alert("Erro ao carregar lista de arquivos.");
        console.error("Erro detalhado:", error);
      }
    };

    function abrirItemSelecionado() {
      const lista = document.getElementById('lista');
      const caminho = lista.value;
      if (!caminho) return alert("Selecione um arquivo.");

      // Mostrar modal com PDF
      const modal = document.getElementById('modal');
      const frame = document.getElementById('pdfFrame');
      frame.src = caminho;
      modal.style.display = 'flex';
    }

    function fecharModal() {
      const modal = document.getElementById('modal');
      const frame = document.getElementById('pdfFrame');
      frame.src = ""; // Limpa para parar carregamento
      modal.style.display = 'none';
      document.getElementById('lista').value = ""; // limpa seleÃ§Ã£o
    }
  </script>

</body>
</html>
